% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/helpers-inits.R
\name{construct_initfun}
\alias{construct_initfun}
\title{Generic S3 method for constructing a function to generate initial values for a bmmodel}
\usage{
construct_initfun(model, data, formula, ...)
}
\arguments{
\item{model}{A \code{bmmodel} object}

\item{data}{A data.frame containing the data used in the model}

\item{formula}{A \code{brmsformula} object returned from configure_model()}

\item{...}{Additional arguments passed to the method}

\item{user_prior}{A \code{brmsprior} object given by the user as an argument to
bmm()}
}
\value{
A \code{brmsprior} object containing the default priors for the model
}
\description{
Called by bmm() to automatically constructing a function that generates initial values
to ensure proper starting values. This function is particularly relevant for accumulation
models that require non-decition times smaller than the minimal RT and sufficiently large
boundary separation values to ensure proper sampling.
}
\examples{
\dontshow{if (isTRUE(Sys.getenv("BMM_EXAMPLES"))) (if (getRversion() >= "3.4") withAutoprint else force)(\{ # examplesIf}
configure_prior.mixture3p <- function(model, data, formula, user_prior, ...) {
  # if there is set_size 1 in the data, set constant prior over thetant for set_size1
  prior <- brms::empty_prior()
  set_size_var <- model$other_vars$set_size
  prior_cond <- any(data$ss_numeric == 1) && !is.numeric(data[[set_size_var]])

  thetant_preds <- rhs_vars(formula$pforms$thetant)
  if (prior_cond && set_size_var \%in\% thetant_preds) {
    prior <- prior + brms::prior_("constant(-100)",
      class = "b",
      coef = paste0(set_size_var, 1),
      nlpar = "thetant"
    )
  }
  # check if there is a random effect on theetant that include set_size as predictor
  bterms <- brms::brmsterms(formula$pforms$thetant)
  re_terms <- bterms$dpars$mu$re
  if (!is.null(re_terms)) {
    for (i in 1:nrow(re_terms)) {
      group <- re_terms$group[[i]]
      form <- re_terms$form[[i]]
      thetant_preds <- rhs_vars(form)

      if (prior_cond && set_size_var \%in\% thetant_preds) {
        prior <- prior + brms::prior_("constant(1e-8)",
          class = "sd",
          coef = paste0(set_size_var, 1),
          group = group,
          nlpar = "thetant"
        )
      }
    }
  }

  prior
}
\dontshow{\}) # examplesIf}
}
\keyword{developer}
\keyword{internal}
