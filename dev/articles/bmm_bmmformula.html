<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="bmm">
<title>Introduction to the bmmformula syntax • bmm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the bmmformula syntax">
<meta property="og:description" content="bmm">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">bmm</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.5.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://venpopov.github.io/bmm/dev/dev-notes/index.html">Develop</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/venpopov/bmm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to the bmmformula syntax</h1>
                        <h4 data-toc-skip class="author">Ven Popov</h4>
                        <h4 data-toc-skip class="author">Gidon Frischkorn</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/venpopov/bmm/blob/HEAD/vignettes/bmm_bmmformula.Rmd" class="external-link"><code>vignettes/bmm_bmmformula.Rmd</code></a></small>
      <div class="d-none name"><code>bmm_bmmformula.Rmd</code></div>
    </div>

    
    
<style type="text/css">
div.main-container {
max-width: 800px !important;
}

p {
margin-top: 1.5em ;
margin-bottom: 1.5em ;
}
.author{
    display: none;
}
</style>
<div class="section level2" number="1">
<h2 id="the-bmmformula-syntax">
<span class="header-section-number">1</span> The <code>bmmformula</code> syntax<a class="anchor" aria-label="anchor" href="#the-bmmformula-syntax"></a>
</h2>
<p>The <code>bmmformula</code> syntax generally follows the same principles as the formula syntax for <a href="https://rdrr.io/cran/brms/man/brmsformula.html" class="external-link"><code>brms</code> models</a>. A <code>bmmformula</code> follows the general structure:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameter</span> <span class="op">~</span> <span class="va">peffects</span> <span class="op">+</span> <span class="op">(</span> <span class="va">geffects</span> <span class="op">|</span> <span class="va">group</span><span class="op">)</span></span></code></pre></div>
<p>However, instead of predicting a <code>response</code> - as is typically done in <code>brms</code> - in <code>bmm</code> a <code>bmmformula</code> predicts a <code>parameter</code> from a <code>bmmodel</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;You can always find information on the parameters of a &lt;code&gt;bmmodel&lt;/code&gt; by calling the help for the model you want to fit: &lt;code&gt;?bmmodel&lt;/code&gt;&lt;/p&gt;"><sup>1</sup></a>. The <code>peffects</code> part specifies all effects that are assumed to be the same across observations. In typical vocabulary such effects are called ‘population-level’ or ‘overall’ effects. The <code>geffects</code> part specifies effects that are assumed to vary across grouping variables specified in <code>group</code>. Typically, these effects are called ‘group-level’ or ‘varying’ effects.</p>
<p>As you will typically provide a <code>bmmformula</code> for each parameter of a <code>bmmodel</code>, we recommend to set up the formula in a separate object before passing it to the <code><a href="../reference/bmm.html">bmm()</a></code> function. There are two ways to set up formulas, both work equally easy and well:</p>
<ol style="list-style-type: decimal">
<li>a single call to the function <code>bmmformula</code> or its short form <code>bmf</code>, separating formulas for different parameters by commas.</li>
<li>add a <code>bmmformula</code> for each parameter by using the <code>+</code> operator.</li>
</ol>
<p>Ηere are two examples for each method that result in the same <code>bmmformula</code> object:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bmmformula.html">bmmformula</a></span><span class="op">(</span></span>
<span>  <span class="va">thetat</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">set_size</span>,</span>
<span>  <span class="va">thetant</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">set_size</span>,</span>
<span>  <span class="va">kappa</span> <span class="op">~</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bmmformula.html">bmf</a></span><span class="op">(</span><span class="va">thetat</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">set_size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/bmmformula.html">bmf</a></span><span class="op">(</span><span class="va">thetant</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">set_size</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/bmmformula.html">bmf</a></span><span class="op">(</span><span class="va">kappa</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">my_formula</span></span>
<span><span class="co">#&gt; thetat ~ 1 + set_size</span></span>
<span><span class="co">#&gt; thetant ~ 1 + set_size</span></span>
<span><span class="co">#&gt; kappa ~ 1</span></span></code></pre></div>
<p>As noted above, <code>bmm</code> generally assumes that you pass a <code>bmmformula</code> for each parameter of a model. If you do not pass a <code>bmmformula</code> for one or more parameters, <code>bmm</code> will throw a warning and only estimate a fixed intercept for the parameters for which no <code>bmmformula</code> was provided. If you are unsure about the parameters of a model, call the help via <code>?bmmodel</code>, replacing ‘bmmodel’ with the name of the model (e.g. <code><a href="../reference/SDM.html">?sdm</a></code>).</p>
<p>As <code>bmmformula</code> syntax builds upon <code>brmsformula</code> syntax, you can use any functionality you might use in <code>brms</code> for specifying a <code>bmmformula</code>. One difference is, that you <em>do not</em> have to explicitly specify if a formula is a non-linear formula, as <code>bmm</code> recognizes a formula as non-linear as soon as one of the left-hand side arguments of a formula is also used as a right-hand side argument in the whole formula. So the argumetn <code>nl</code> does not exist for <code>bmmformula</code>. Similarly, adding grouping statements around group-level effects to estimate them separately for different sub-groups in your design can be added. So for example, a more complicated <code>bmmformula</code> could look like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">complex_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bmmformula.html">bmf</a></span><span class="op">(</span></span>
<span>  <span class="co"># a non-linear function on thetat</span></span>
<span>  <span class="va">thetat</span> <span class="op">~</span> <span class="va">end_theta</span> <span class="op">+</span> <span class="op">(</span><span class="va">start_theta</span> <span class="op">-</span> <span class="va">end_theta</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">R</span><span class="op">*</span><span class="va">ss_num</span><span class="op">)</span>,</span>
<span>  <span class="co"># other model parameters</span></span>
<span>  <span class="va">thetant</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html" class="external-link">gr</a></span><span class="op">(</span><span class="va">ID</span>, by <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">kappa</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html" class="external-link">gr</a></span><span class="op">(</span><span class="va">ID</span>, by <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># parameters of the non-linear function</span></span>
<span>  <span class="va">start_theta</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html" class="external-link">gr</a></span><span class="op">(</span><span class="va">ID</span>, by <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">end_theta</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html" class="external-link">gr</a></span><span class="op">(</span><span class="va">ID</span>, by <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">R</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="fu"><a href="https://paul-buerkner.github.io/brms/reference/gr.html" class="external-link">gr</a></span><span class="op">(</span><span class="va">ID</span>, by <span class="op">=</span> <span class="va">age_group</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">complex_formula</span></span>
<span><span class="co">#&gt; thetat ~ end_theta + (start_theta - end_theta) * exp(-R * ss_num)</span></span>
<span><span class="co">#&gt; thetant ~ 1 + (1 | gr(ID, by = age_group))</span></span>
<span><span class="co">#&gt; kappa ~ 1 + (1 | gr(ID, by = age_group))</span></span>
<span><span class="co">#&gt; start_theta ~ 1 + (1 | gr(ID, by = age_group))</span></span>
<span><span class="co">#&gt; end_theta ~ 1 + (1 | gr(ID, by = age_group))</span></span>
<span><span class="co">#&gt; R ~ 1 + (1 | gr(ID, by = age_group))</span></span></code></pre></div>
<p>This formula implements an exponential reduction in <code>thetat</code> from a <code>start_theta</code> at <code>ss_num = 0</code> towards the lower asymptote <code>end_theta</code> that will be reached with the slope <code>R</code>. In addition, the group level effects have been grouped by <code>age_group</code> so that the variation in the <code>Intercept</code> would be estimated separately for different levels of the <code>age_group</code> variable. This formula just serves as an example how <code>bmmformula</code> syntax allows to use the complex formula syntax implemented in <code>brms</code> and passes the information on to <code>brms</code> without losing any of the functionality.</p>
</div>
<div class="section level2" number="2">
<h2 id="seperating-response-variables-from-model-parameters">
<span class="header-section-number">2</span> Seperating response variables from model parameters<a class="anchor" aria-label="anchor" href="#seperating-response-variables-from-model-parameters"></a>
</h2>
<p>As the response is not provided to the <code>bmmformula</code>, in <code>bmm</code> the response variables, and also other variables relevant for a <code>bmmodel</code>, are linked to the model when setting up the <code>bmmodel</code> object. For example, when fitting the <code>mixture3p</code> model, you have to provide the names of the variables that reflect the response error (e.g., <code>y</code>), the location of the non-target features (e.g. <code>nt_col1</code>, …, <code>nt_col4</code>), and the set-size (e.g., <code>ss</code>) in our data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixture3p.html">mixture3p</a></span><span class="op">(</span>resp_error <span class="op">=</span> <span class="st">"y"</span>, </span>
<span>                      nt_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"nt_col"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, </span>
<span>                      set_size <span class="op">=</span> <span class="st">"ss"</span><span class="op">)</span></span></code></pre></div>
<p>Internally, <code>bmm</code> will then link the response variables to the <code>bmmformula</code> given for the parameters of a <code>bmmodel</code>.</p>
</div>
<div class="section level2" number="3">
<h2 id="fixing-parameters-to-constant-values">
<span class="header-section-number">3</span> Fixing parameters to constant values<a class="anchor" aria-label="anchor" href="#fixing-parameters-to-constant-values"></a>
</h2>
<p>In some cases it can be reasonable to fix parameters to a specific value. This can either be done via the <code>bmmformula</code> or via a <a href="https://github.com/paul-buerkner/brms/issues/783#issuecomment-577909409" class="external-link">constant prior</a> specified for the parameter to be fixed. Here we will only outline fixing parameters via the <code>bmmformula</code>.</p>
<p>To fix a parameter via the <code>bmmformula</code> you have to set the parameter to the value it should be fixed to by using <code>=</code> instead of <code>~</code>. For example, the following formula would fix <code>kappa</code> to the value <code>1</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bmmformula.html">bmf</a></span><span class="op">(</span>kappa <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>When fixing a parameter to a constant value, you need to keep in mind that the value you fix it to, is the value on the parameter scale. Oftentimes, <code>bmm</code> uses link functions to convert parameters from a bounded native scale (e.g. only positive values for precision parameters, such as <code>kappa</code>) to an unbounded parameter scale. In the case of <code>kappa</code>, <code>bmm</code> uses a <code>log</code> link function. Thus, when fixing the parameter to <code>1</code>, this will effectively fix the parameter to <span class="math inline">\(e^1\)</span> on the native scale.</p>
</div>
<div class="section level2" number="4">
<h2 id="estimating-prediciting-parameters-internally-fixed-by-bmm">
<span class="header-section-number">4</span> Estimating &amp; prediciting parameters internally fixed by <code>bmm</code><a class="anchor" aria-label="anchor" href="#estimating-prediciting-parameters-internally-fixed-by-bmm"></a>
</h2>
<p><code>bmm</code> fixes some parameters internally, as they are usually not an integral part of a measurement model, or need to be fixed to properly identify the model. For example in models for continuous reproduction visual working memory tasks, the distribution of target responses is usually assumed to be centered around the target. Consequently, the mean of this distribution <code>mu</code> is internally fixed to <code>0</code>. Such parameters are listed in the model object. So, you can see if a model has such parameters by accessing <code>my_model$fixed_parameters</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SDM.html">sdm</a></span><span class="op">(</span>resp_error <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span></span>
<span><span class="va">my_model</span><span class="op">$</span><span class="va">fixed_parameters</span></span>
<span><span class="co">#&gt; $mu</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>Fixed parameters that can be freely estimated are also listed in the <code>parameters</code> of a model, that you can access using <code>my_model$parameters</code>. Parameters that are only listed in the <code>fixed_parameters</code> but not part of the <code>parameters</code> need to be fixed for identification purposes and thus cannot be estimated freely. For example in the <code>mixture_vwm</code> models, the location <code>mu2</code> and precision <code>kappa2</code> of the guessing distributions needs to be fixed for model identification. These parameters are listed in the <code>fixed_parameters</code> but not in the <code>parameters</code> and therefore cannot be estimated. Only, the internally fixed location of the target responses <code>mu1</code> can be estimated freely if needed.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixture2p.html">mixture2p</a></span><span class="op">(</span>resp_error <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">my_model</span><span class="op">$</span><span class="va">fixed_parameters</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mu1"    "mu2"    "kappa2"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">my_model</span><span class="op">$</span><span class="va">parameters</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mu1"    "kappa"  "thetat"</span></span></code></pre></div>
<p>If you want to freely estimate an internally fixed parameters, then you can freely estimate this parameter by providing a <code>bmmformula</code> for it. In the case of the above mentioned visual working memory models, you could for example be interested in seeing if subjects were biased (e.g., by distractors). If you want to estimate the overall bias in your data including variations between subjects indicated by <code>ID</code>, then you would additionally specify a <code>bmmformula</code> for <code>mu</code> in addition to the other formulas for the core mode parameters:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixture2p.html">mixture2p</a></span><span class="op">(</span>resp_error <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span></span>
<span><span class="va">my_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bmmformula.html">bmf</a></span><span class="op">(</span></span>
<span>  <span class="va">mu1</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>  <span class="va">thetat</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>  <span class="va">kappa</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2" number="5">
<h2 id="accessing-the-brmsformula-generated-by-bmm">
<span class="header-section-number">5</span> Accessing the <code>brmsformula</code> generated by <code>bmm</code><a class="anchor" aria-label="anchor" href="#accessing-the-brmsformula-generated-by-bmm"></a>
</h2>
<p>Let’s assume you have fit a <code>mixture2p</code> model to a data set <code>my_data</code> as in the <code><a href="../articles/bmm_mixture_models.html">vignette("bmm_mixture_models")</a></code>. For this, you had to specify a <code>bmmformula</code> and model object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">user_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bmmformula.html">bmf</a></span><span class="op">(</span></span>
<span>  <span class="va">thetat</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>,</span>
<span>  <span class="va">kappa</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">+</span> <span class="op">(</span><span class="fl">0</span> <span class="op">+</span> <span class="va">set_size</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mixture2p.html">mixture2p</a></span><span class="op">(</span>resp_error <span class="op">=</span> <span class="st">"error"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bmmfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bmm.html">bmm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">user_formula</span>,</span>
<span>  data <span class="op">=</span> <span class="va">my_data</span>,</span>
<span>  model <span class="op">=</span> <span class="va">my_model</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>If you were now interested to see how the <code>bmmformula</code> that you passed to <code>bmm</code> is converted to a <code>brmsformula</code>, you can access the <code>brmsformula</code> via the <code>bmmfit</code> object that will be returned by the <code><a href="../reference/bmm.html">bmm()</a></code> function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmmfit</span><span class="op">$</span><span class="va">formula</span></span>
<span><span class="co">#&gt; error ~ 1 </span></span>
<span><span class="co">#&gt; mu1 ~ 1</span></span>
<span><span class="co">#&gt; kappa ~ 0 + set_size + (0 + set_size || id)</span></span>
<span><span class="co">#&gt; thetat ~ 0 + set_size + (0 + set_size || id)</span></span>
<span><span class="co">#&gt; kappa2 ~ 1</span></span>
<span><span class="co">#&gt; mu2 ~ 1</span></span>
<span><span class="co">#&gt; kappa1 ~ kappa</span></span>
<span><span class="co">#&gt; theta1 ~ thetat</span></span></code></pre></div>
<p>Similarly, you can access the distributional family that was used to implement the specified model, so <code>bmmfit$family</code> will return the family object that was generated by <code>bmm</code> and then passed to <code>brms</code> for fitting.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bmmfit</span><span class="op">$</span><span class="va">family</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Mixture</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: von_mises </span></span>
<span><span class="co">#&gt; Link function: tan_half </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: von_mises </span></span>
<span><span class="co">#&gt; Link function: tan_half</span></span></code></pre></div>
<p>Finally, you can also access the data that was used by <code>bmm</code> to fit the model via <code>bmmfit$data</code>. In many cases this data will be equal to the data provided by the user. But sometimes <code>bmm</code> internally computes additional index variables for specifying the models adequately. The data stored in the <code>bmmfit</code> object contains these additional variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bmmfit</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt;        error set_size id</span></span>
<span><span class="co">#&gt; 1 -0.0130000        1  1</span></span>
<span><span class="co">#&gt; 2 -0.0660000        1  1</span></span>
<span><span class="co">#&gt; 3  0.1891853        1  1</span></span>
<span><span class="co">#&gt; 4 -0.4500000        1  1</span></span>
<span><span class="co">#&gt; 5 -0.0210000        1  1</span></span>
<span><span class="co">#&gt; 6 -0.0740000        1  1</span></span></code></pre></div>
<p>This way, should you be interested to customize models to fit them in <code>brms</code> without <code>bmm</code>, you are able to obtain the most important information that is essential for specifying the models implemented in <code>bmm</code>.</p>
<p>Fit objects from <code>bmm</code> use a custom summary function to format the output. However, you can call a <code>brms</code> summary instead of a <code>bmm</code> summary by setting the <code>backend</code> option in the summary function to <code>brms</code>. This way the summary function for <code>brmsfit</code> objects will be used instead of the function for <code>bmmfit</code> objects. The <code>brmsfit</code> summary also contains the <code>brmsformula</code> that is created by <code>bmm</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bmmfit</span>, backend <span class="op">=</span> <span class="st">"brms"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  Family: mixture(von_mises, von_mises) </span></span>
<span><span class="co">#&gt;   Links: mu1 = tan_half; kappa1 = log; mu2 = tan_half; kappa2 = log; theta1 = identity; theta2 = identity </span></span>
<span><span class="co">#&gt; Formula: error ~ 1 </span></span>
<span><span class="co">#&gt;          mu1 ~ 1</span></span>
<span><span class="co">#&gt;          kappa ~ 0 + set_size + (0 + set_size || id)</span></span>
<span><span class="co">#&gt;          thetat ~ 0 + set_size + (0 + set_size || id)</span></span>
<span><span class="co">#&gt;          kappa2 ~ 1</span></span>
<span><span class="co">#&gt;          mu2 ~ 1</span></span>
<span><span class="co">#&gt;          kappa1 ~ kappa</span></span>
<span><span class="co">#&gt;          theta1 ~ thetat</span></span>
<span><span class="co">#&gt;    Data: dat_preprocessed (Number of observations: 7271) </span></span>
<span><span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;</span></span>
<span><span class="co">#&gt;          total post-warmup draws = 4000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multilevel Hyperparameters:</span></span>
<span><span class="co">#&gt; ~id (Number of levels: 12) </span></span>
<span><span class="co">#&gt;                      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; sd(kappa_set_size1)      0.36      0.10     0.22     0.61 1.00     1437     1992</span></span>
<span><span class="co">#&gt; sd(kappa_set_size2)      0.21      0.08     0.09     0.39 1.00     1677     2111</span></span>
<span><span class="co">#&gt; sd(kappa_set_size4)      0.34      0.11     0.18     0.60 1.00     1900     2986</span></span>
<span><span class="co">#&gt; sd(kappa_set_size6)      0.43      0.15     0.19     0.78 1.00     1774     2241</span></span>
<span><span class="co">#&gt; sd(thetat_set_size1)     0.57      0.46     0.03     1.69 1.00     1506     2270</span></span>
<span><span class="co">#&gt; sd(thetat_set_size2)     0.92      0.29     0.49     1.64 1.00     1622     2536</span></span>
<span><span class="co">#&gt; sd(thetat_set_size4)     0.95      0.28     0.55     1.62 1.00     1436     2468</span></span>
<span><span class="co">#&gt; sd(thetat_set_size6)     0.67      0.20     0.38     1.15 1.00     1648     2245</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Regression Coefficients:</span></span>
<span><span class="co">#&gt;                  Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span></span>
<span><span class="co">#&gt; mu1_Intercept        0.00      0.00     0.00     0.00   NA       NA       NA</span></span>
<span><span class="co">#&gt; mu2_Intercept        0.00      0.00     0.00     0.00   NA       NA       NA</span></span>
<span><span class="co">#&gt; kappa2_Intercept  -100.00      0.00  -100.00  -100.00   NA       NA       NA</span></span>
<span><span class="co">#&gt; kappa_set_size1      2.89      0.11     2.66     3.10 1.00     1428     2089</span></span>
<span><span class="co">#&gt; kappa_set_size2      2.40      0.08     2.24     2.56 1.00     2667     2568</span></span>
<span><span class="co">#&gt; kappa_set_size4      2.07      0.12     1.83     2.32 1.00     2217     2489</span></span>
<span><span class="co">#&gt; kappa_set_size6      1.94      0.16     1.64     2.25 1.00     2069     2383</span></span>
<span><span class="co">#&gt; thetat_set_size1     4.51      0.37     3.86     5.33 1.00     3805     2257</span></span>
<span><span class="co">#&gt; thetat_set_size2     2.55      0.30     1.96     3.19 1.00     1866     2466</span></span>
<span><span class="co">#&gt; thetat_set_size4     1.08      0.29     0.51     1.65 1.01      942     1424</span></span>
<span><span class="co">#&gt; thetat_set_size6     0.31      0.21    -0.11     0.73 1.00     1523     2163</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS</span></span>
<span><span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span></span>
<span><span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></span></code></pre></div>
<p>Compare this with the default summary method for <code>bmmfit</code> objects:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bmmfit</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span style="color: #AF5FFF;">  Model: </span><span style="color: #FF875F;">mixture2p</span>(resp_err = "error") 
<span style="color: #AF5FFF;">  Links: </span>mu1 = tan_half; kappa = log; thetat = identity 
<span style="color: #AF5FFF;">Formula: </span>mu1 = 0
         kappa ~ 0 + set_size + (0 + set_size || id)
         thetat ~ 0 + set_size + (0 + set_size || id) 
<span style="color: #AF5FFF;">   Data:</span> dat_preprocessed (Number of observations: 7271)
<span style="color: #AF5FFF;">  Draws: </span>4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

<span style="color: #00BB00;">Multilevel Hyperparameters:
</span>~id (Number of levels: 12) 
                     Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(kappa_set_size1)      0.36      0.10     0.22     0.61 1.00     1437     1992
sd(kappa_set_size2)      0.21      0.08     0.09     0.39 1.00     1677     2111
sd(kappa_set_size4)      0.34      0.11     0.18     0.60 1.00     1900     2986
sd(kappa_set_size6)      0.43      0.15     0.19     0.78 1.00     1774     2241
sd(thetat_set_size1)     0.57      0.46     0.03     1.69 1.00     1506     2270
sd(thetat_set_size2)     0.92      0.29     0.49     1.64 1.00     1622     2536
sd(thetat_set_size4)     0.95      0.28     0.55     1.62 1.00     1436     2468
sd(thetat_set_size6)     0.67      0.20     0.38     1.15 1.00     1648     2245

<span style="color: #00BB00;">Regression Coefficients:
</span>                 Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
kappa_set_size1      2.89      0.11     2.66     3.10 1.00     1428     2089
kappa_set_size2      2.40      0.08     2.24     2.56 1.00     2667     2568
kappa_set_size4      2.07      0.12     1.83     2.32 1.00     2217     2489
kappa_set_size6      1.94      0.16     1.64     2.25 1.00     2069     2383
thetat_set_size1     4.51      0.37     3.86     5.33 1.00     3805     2257
thetat_set_size2     2.55      0.30     1.96     3.19 1.00     1866     2466
thetat_set_size4     1.08      0.29     0.51     1.65 1.01      942     1424
thetat_set_size6     0.31      0.21    -0.11     0.73 1.00     1523     2163

<span style="color: #00BB00;">Constant Parameters:
</span>                  Value
mu1_Intercept      0.00

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).
</code></pre>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vencislav Popov, Gidon Frischkorn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
